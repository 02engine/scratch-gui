name: Generate changelog.json from Releases

on:
  workflow_dispatch:    # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * *'

permissions:
  contents: write

jobs:
  generate-versions:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # éœ€è¦å®Œæ•´çš„ tag å†å²

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm install @octokit/rest dayjs

      - name: Generate changelogs.json
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: node generate-changelog.js

      - name: Show generated JSON (for debug)
        run: cat changelog/changelog.json || true

      # éƒ¨ç½²å•ä¸ªæ–‡ä»¶åˆ° cf-page åˆ†æ”¯
      - name: éƒ¨ç½²åˆ° cf-page åˆ†æ”¯ ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: cf-page                 
          folder: ./changelog                              
          target-folder: .                        
          clean: false          
          commit-message: "chore: æ¯æ—¥æ›´æ–° changelog.json (${{ github.run_id }})"

